<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Home Page</title>

    <meta
      name="description"
      content="Source code generated using layoutit.com"
    />
    <meta name="author" content="LayoutIt!" />

    <!-- <link href="css/bootstrap.min.css" rel="stylesheet" />   -->
    <!-- <link href="css/style.css" rel="stylesheet" /> -->

    <style>
      .mybox{
        height:485px;
        overflow-x: auto;
      }
      #sentence {
        font-size: 20px;
        font-weight: bold;
      }
      #map {
        margin-top:0%;
        /* height: 40%; */
      }
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

       /*set the background*/
       .bg {
        background: url('./img/homepage_img.jpg');
        background-repeat: no-repeat;
        background-position: center;
        background-size: cover; 
        overflow: hidden;
        position: fixed;
        width:100%;
        height:100%; 
        background-color:transparent;

      }
      .inner{
        height:100%;
        background: rgba(138, 134, 134, 0.575);
      }

      
      .marginSearch{
        margin-bottom:5%;
      }
      .input-group {
            width: 35%;
        }
      .textBg{
        background:rgb(252, 250, 250);
        position:absolute;
        left:15%;
        right:15%;
        bottom:35%;
        top:5%;
        text-align: center;
        height:auto;
        width:auto;
        font-size:100%;
        color:rgb(17, 17, 17);
        border-radius:25px;
        padding:3% 5% 5% 5%;
      }

        



      .inputBg{
        background:rgb(252, 250, 250);
        position:absolute;
        top:10%;
        right:0%;
        left:0%;
        height:10%;
        /* display: flex;
        align-items: center; */
        font-size:100%;
        color:rgb(17, 17, 17);
        /* border-radius:25px; */
        /* padding: 3% 0; */
        }


      .tag{
        width: auto;
        height: 180%;
        /* object-fit:cover; */
      }



   

      
    </style>
    <link href="css/style.css" rel="stylesheet" />
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">


    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>

   

   
  </head>
  <body onload="explore()">
    <div class="container-fluid">
    <div calss="col-md-12">

      <nav class="navbar navbar-default navbar-fixed-top" role="navigation"> 
        <div class="container-fluid"> 
            <div class="navbar-header">
              <div class="navbar-brand">
                <img  src="/img/logo.png" class="tag" alt="" >
              </div>    
            </div> 
            <div id="navbar" class="collapse navbar-collapse">
              <ul class="nav navbar-nav">
                <li class="active"><a href="/homepage.html">Home</a></li>
                <li><a href="/index.html">Sign In</a></li>
                <li><a href="/signup.html">Sign Up</a></li>
                <li><a href="/addroom.html">Add Room</a></li>
              </ul> 
            </div> 
        </div>
      </nav>

    <div class="bg" style="margin-top:0;">
    <div class="inner">

      <!-- <div class="row">  -->
        <form role="form" id="search-form" method="post" class="inputBg">
            <div class="form-inline" style="position: absolute;top: 30%;left:1% ">
                <label for="exampleInputEmail1">Address</label>
                <input size="10%" type="text" id="address" name="address" class="form-control" placeholder="Waterloo"/>
                <span id = "reminder_address"></span>
            </div>
            <div class="form-inline" style="position: absolute;top: 30%;left:15%">
                <label for="exampleInputPassword1">Number of bed</label>
                <input size="10%" type="text" id="beds" name="beds" class="form-control" onchange="remap()"/>
                <span id = "reminder_beds"></span>
            </div>
            <div class="form-inline" style="position: absolute; top: 30%;left:32%">
                <label for="exampleInputPassword1">Check in</label>
                <input size="10%" type="date" class="form-control" id="date_start" name="date_start"/>
            </div>
            <div class="form-inline" style="position:absolute; top: 30%;left:52%">
                <label for="exampleInputPassword1">Check out</label>
                <input size="8%" type="date" class="form-control" id="date_end" name="date_end"/>
            </div>
            <div class="form-inline" style="position:absolute; top: 30%;left:73%">
                <!-- <form class="form-horizontal" role="form"> -->
                    <div class="form-group">
                       <label for="exampleInputPassword1">Search Radius(KM)</label>
                               <em class="jian" style="cursor:pointer">-</em>
                               <input type="text" size="8%" value="1" class="form-control" id = "Distance" name ="Distance" data-decimals="1" min="0" max="9" step="0.1"/>
                               <em class="add" style="cursor:pointer">+</em>
                    </div>
                <!-- </form> -->
                <span id = "reminder_distance"></span>          
            </div>
            <div class="form-inline" style="position:absolute; top: 30%;left:94%">
                <!-- <form class="form-horizontal" role="form"> -->
                    <button type="submit" class="btn btn-primary marginSearch" id = "search" value="search">
                        Search
                    </button>
                <!-- </form> -->
            </div>
        </form>
      <!-- </div> -->


     
     
        <div class="row">
        <div class="col-md-6" style="height:0px; padding-bottom:60%; margin-top:12%">
          <div class="textBg">        
            <div class="form-group" style="position:absolute; top:2%; left:5%; right:5%;bottom:10%">
              <div class="show" id="show" style="text-align: center">
                <div id ="show_title">
                  <span id="sentence">Explore new airbnb:</span>
                </div>
                <div id = "show_table" style="padding-top:20px" style = "height:400px" class="mybox">
                </div>
              </div>
            </div>

          </div>
        </div>
        <div class="col-md-6" style="height:0px; padding-bottom:60%; margin-top:12%">
          <div class="textBg" style="background:transparent" id="map">    
          </div>
        </div>
        </div>



    </div>
    </div>

    </div>
    </div>
    




    <script>
      var map;
      var lat;
      var lng;
      var input
      var now = new Date();
      var day = ("0" + now.getDate()).slice(-2);
      var month = ("0" + (now.getMonth() + 1)).slice(-2);
      var today = now.getFullYear()+"-"+(month)+"-"+(day);
      $('#date_start').val(today);
      var next_month = ("0" + (now.getMonth() +2)).slice(-2);
      var end_date = now.getFullYear()+"-"+(next_month)+"-"+(day);
      $('#date_end').val(end_date);
      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 43.4715909, lng: -80.54578249999997 },
          zoom: 15
        });
      }
      function remap() {
        var addr = document.getElementById("address").value;
        var geocoder = new google.maps.Geocoder();
        geocodeAddress(geocoder, map);
        function geocodeAddress(geocoder, resultsMap) {
          geocoder.geocode({ address: addr }, function(results, status) {
            if (status === "OK") {
              resultsMap.setCenter(results[0].geometry.location);
              map.setZoom(15);
              lat = results[0].geometry.location.lat();
              lng = results[0].geometry.location.lng();
            } else {
              alert(
                "Geocode was not successful for the following reason: " + status
              );
            }
          });
        }
      }

      var flag = 0;
      var search_form = document.getElementById("search-form");
      search_form.onsubmit = function(e) {
        e.preventDefault();

        var address = document.getElementById("address").value;
        console.log("ad1");
        if (address == "") {
        console.log("ad2");
        document.getElementById("reminder_address").innerHTML =
        "please enter your address";
        flag = 1;
    }
        var beds = document.getElementById("beds").value;
        console.log("bed1");
        if (beds == "") {
        console.log("bed2");
        document.getElementById("reminder_beds").innerHTML =
        "please enter your beds";
        flag = 1;
    }

        console.log("distance")
        var distance = document.getElementById("Distance").value;
        console.log('typ');
        console.log("dis1");
        if (distance == "") {
        console.log("dis2");
        document.getElementById("reminder_distance").innerHTML =
        "please enter your distance";
        flag = 1;
    }
    
        initMap();
        remap();
        document.getElementById("show_table").innerHTML = "";
        document.getElementById("show_title").innerHTML = "";
        var title1 = document.createElement("span");
        title1.id = "sentence";
        title1.innerHTML = "Search result:";
        $("#show_title").append(title1);
        var addr = document.getElementById("address").value;
        var begindate = document.getElementById("date_start").value;
        var enddate = document.getElementById("date_end").value;
        var bed_num = parseInt(document.getElementById("beds").value);
        var distance = document.getElementById("Distance").value;
        $.ajax({
          type: "GET",
          url: "/api/house/search",
          data: {
            longitude: lng,
            latitude: lat,
            date_begin: begindate,
            date_end: enddate,
            number_of_beds: bed_num,
            max_distance: distance*1000
          },
          success: function(msg) {
            var geocoder = new google.maps.Geocoder();
            var search_result = msg.house_list;
            var table = document.createElement("table");
            table.setAttribute("border", "1");
            table.setAttribute("style", " width:500px; table-layout: fixed;");
            $.each(search_result, function(index, n) {
              var rowTr = document.createElement("tr");
              if(search_result[index].active == false)
              {
                rowTr.setAttribute("style", "background-color: #F78181;");
              }
              var td_1 = document.createElement("td");
              td_1.setAttribute("align", "center");
              var home_id = search_result[index].house_id;
              td_1.innerHTML = "<a href=\"detail.html?home_id="+home_id+"\">" + search_result[index].name + "</a>";
              var td_2 = document.createElement("td");
              td_2.setAttribute("align","center");
              td_2.setAttribute("style", "width:400;");
              td_2.innerHTML = search_result[index].address + "," + search_result[index].city + "," + search_result[index].province;
              var td_3 = document.createElement("td");
              td_3.setAttribute("align", "center");
              td_3.innerHTML = "$" + search_result[index].price;
              var houseid = search_result[index].house_id;
              rowTr.appendChild(td_1);
              rowTr.appendChild(td_2);
              rowTr.appendChild(td_3);
              $.ajax({
                type: "GET",
                url: "/api/house/download_photos",
                data: {
                  house_id: houseid
                },
                success: function(msg) {
                      var pic_list = msg.info;
                      var td_4 = document.createElement("td");
                      td_4.setAttribute("style", "width:80; height:80;");
                      var img = document.createElement("img");
                      img.setAttribute("style", "width:80px;height:80px");
                      img.src = pic_list[0];
                      td_4.append(img);
                      rowTr.appendChild(td_4);
                }
              }); 
              table.appendChild(rowTr);
              $("#show_table").append(table);
              var geocoder = new google.maps.Geocoder();
              geocodeAddress(geocoder, map);
              function geocodeAddress(geocoder, resultsMap) {
                geocoder.geocode(
                  { placeId: search_result[index].place_id },
                  function(results, status) {
                    if (status === "OK") {
                      var marker = new google.maps.Marker({
                        map: resultsMap,
                        position: results[0].geometry.location
                      });
                    } else {
                      alert(
                        "Geocode was not successful for the following reason: " +
                          status
                      );
                    }
                  }
                );
              }
            });
          },
          fail: function() {
            console.log("search failed");
          }
        });
      };

      function explore() {
        $.ajax({
          type: "GET",
          url: "/api/house/search",
          success: function(data) {
            var room_information = data.house_list;
            var table = document.createElement("table");
            table.setAttribute("border", "1");
            table.setAttribute("style", " width:500px; table-layout: fixed;");
            $.each(room_information, function(index, n) {
              var rowTr = document.createElement("tr");
              var td_1 = document.createElement("td");
              td_1.setAttribute("align", "center");
              var home_id = room_information[index].house_id;
              td_1.innerHTML = "<a href=\"detail.html?home_id="+home_id+"\">" + room_information[index].name + "</a>";
              var td_2 = document.createElement("td");
              td_2.setAttribute("align","center");
              td_2.setAttribute("style", "width:400;");
              td_2.innerHTML = room_information[index].address + "," + room_information[index].city + "," + room_information[index].province;
              var td_3 = document.createElement("td");
              td_3.setAttribute("align", "center");
              td_3.innerHTML = room_information[index].price + "$";
              var houseid = room_information[index].house_id;
              rowTr.appendChild(td_1);
              rowTr.appendChild(td_2);
              rowTr.appendChild(td_3);
              $.ajax({
                type: "GET",
                url: "/api/house/download_photos",
                data: {
                  house_id: houseid
                },
                success: function(msg) {
                      var pic_list = msg.info;
                      var td_4 = document.createElement("td");
                      td_4.setAttribute("style", "width:80; height:80;");
                      var img = document.createElement("img");
                      img.setAttribute("style", "width:80px;height:80px");
                      img.src = pic_list[0];
                      td_4.append(img);
                      rowTr.appendChild(td_4);
                }
              }); 
              table.appendChild(rowTr);
            });
            $("#show_table").append(table);
          }
        });
      }
      
      
      



    </script>

    <script src="js/jquery-1.11.0.min.js" type="text/javascript"></script>
    <script src="https://cdn.bootcss.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    
    
    <script>
      $(document).ready(function(){
//加的效果
$(".add").click(function(){
var n=$(this).prev().val();
var num=parseInt(n)+1;
if(num==0){ return;}
$(this).prev().val(num);
});
//减的效果
$(".jian").click(function(){
var n=$(this).next().val();
var num=parseInt(n)-1;
if(num==0){ return}
$(this).next().val(num);
});
})
    </script>

    


    
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDEr7VaXJrWbi79GbHar7CPAS1LyYDAyew&callback=initMap"
      async
      defer
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.2.1/js/bootstrap.min.js"></script>
  </body>
</html>
