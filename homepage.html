<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Home Page</title>

    <meta
      name="description"
      content="Source code generated using layoutit.com"
    />
    <meta name="author" content="LayoutIt!" />

    <!-- <link href="css/bootstrap.min.css" rel="stylesheet" /> -->
    <!-- <link href="css/style.css" rel="stylesheet" /> -->

    <style>
      #sentence {
        font-size: 20px;
        font-weight: bold;
      }
      #map {
        margin-top:0%;
        height: 40%;
      }
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

       /*set the background*/
       .bg {
        background: url('./img/homepage_img.jpg');
        background-repeat: no-repeat;
        background-position: center;
        background-size: cover; 
        /* vertical-align: middle; */
        /* background-clip:border-box; */
        height:auto;
        line-height: auto;
        background-color:transparent;

      }
      .inner{
        height:100%;
        background: rgba(138, 134, 134, 0.575);
      }

      
      .marginSearch{
        margin-bottom:5%;
      }
      .input-group {
            width: 35%;
        }

        .textBgLf{
        background:rgb(252, 250, 250);
        height:95%;
        width:80%;
        /* text-align: center; */
        margin-left: 7%;
        /* margin-right:1%; */
        margin-top:0%;
        margin-bottom:1%;
        font-size:100%;
        color:rgb(17, 17, 17);
        border-radius:25px;
        padding:0.5cm;
      }

      .textBgRt{
        background:rgb(252, 250, 250);
        height:95%;
        width:80%;
        /* text-align: center; */
        /* margin-left: 1%; */
        margin-right:1%;
        margin-top:0%;
        margin-bottom:1%;
        font-size:100%;
        color:rgb(17, 17, 17);
        border-radius:25px;
        padding:0.5cm;
      }
      .tag{
        width: auto;
        height: 180%;
        /* object-fit:cover; */

      }

    </style>
    <link href="css/style.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>

   

   
  </head>
  <body onload="explore()">
      <nav class="navbar navbar-default navbar-fixed-top" role="navigation"> 
          <div class="container-fluid"> 
            <div class="navbar-header">
              <div class="navbar-brand">
                <img  src="/img/logo.png" class="tag" alt="" >
              </div>    
            </div> 
            <div id="navbar" class="collapse navbar-collapse">
              <ul class="nav navbar-nav">
                <li class="active"><a href="">Home</a></li>
                <li><a href="/index.html">Sign In</a></li>
                <li><a href="#">Sign Up</a></li>
                <li><a href="/addroom.html">Add Room</a></li>
                <li><a href="">About</a></li>
                </ul> 
            </div> 
        </nav>

    <div class="bg" style="margin-top:0;">
    <div class="inner">
      <div class="title">
          <div class="row">
            <div class="col-md-12" style="margin-top:5%;margin-bottom:5%">
              <h3 style='text-align: center'>
                Home Page
              </h3>
            </div>
          </div>
       </div>
      <div class="row" style='margin-top:2%; margin-left:2%'> 
        <div class="col-md-6">
        <div class="textBgLf" style="text-align: center">
  
          <span id="sentence">Search Room:</span>
          <form role="form" id="search-form">
            <div class="form-group" style='margin-top:3%'>
              <label for="exampleInputEmail1">
                Address
              </label>
              <div align="center">
              <input
                type="text"
                class="form-control"
                id="address"
                placeholder="Waterloo"
              />
              </div>
            </div>
            <div class="form-group">
              <label for="exampleInputPassword1">
                Number of bed
              </label>
              <div align="center">
              <input
                type="text"
                class="form-control"
                id="beds"
                onchange="remap()"
              />
              </div>
            </div>
            <div class="form-group">
              <label for="exampleInputPassword1">
                Check in
              </label>
              <div align="center">
              <input type="date" class="form-control" id="date_start" />
              </div>
            </div>
            <div class="form-group">
              <label for="exampleInputPassword1">
                Check out
              </label>
              <div align="center">
              <input type="date" class="form-control" id="date_end" />
              </div>
            </div>
            <div class="form-group">
                <label for="exampleInputPassword1">
                 Search Radius(KM)
                </label>
            
               <div align="center" class="htmleaf-container">
                
                  <p>
                    <input class="inputColor" type="number" id = "Distance" value="1" data-decimals="1" min="0" max="9" step="0.1" />
                  </p>
                
               </div>
            </div>


            <button type="submit" class="btn btn-primary marginSearch">
              Search
            </button>
          </form>
        </div>
        </div>
        <div class="col-md-6">
          <div class="textBgLf">
          <div class="show" id="show" style="text-align: center">
            <span id="sentence">Explore new airbnb:</span>
          </div>
          </div>
        </div>
      </div>
      </div>
      </div>
    
    <div id="map"></div>




    <script>
      var map;
      var lat;
      var lng;
      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: -34.397, lng: 150.644 },
          zoom: 15
        });
      }
      function remap() {
        var addr = document.getElementById("address").value;
        var geocoder = new google.maps.Geocoder();
        geocodeAddress(geocoder, map);
        function geocodeAddress(geocoder, resultsMap) {
          geocoder.geocode({ address: addr }, function(results, status) {
            if (status === "OK") {
              resultsMap.setCenter(results[0].geometry.location);
              map.setZoom(15);
              // var marker = new google.maps.Marker({
              //   map: resultsMap,
              //   position: results[0].geometry.location
              // });
              lat = results[0].geometry.location.lat();
              lng = results[0].geometry.location.lng();
            } else {
              alert(
                "Geocode was not successful for the following reason: " + status
              );
            }
          });
        }
      }
      var search_form = document.getElementById("search-form");

      search_form.onsubmit = function(e) {
        e.preventDefault();
        document.getElementById("show").innerHTML = "";
        var title1 = document.createElement("span");
        title1.id = "sentence";
        title1.innerHTML = "Search result:";
        $(".show").append(title1);
        var addr = document.getElementById("address").value;
        var begindate = document.getElementById("date_start").value;
        var enddate = document.getElementById("date_end").value;
        var bed_num = parseInt(document.getElementById("beds").value);
        var distance = document.getElementById("Distance").value;
        $.ajax({
          type: "GET",
          url: "/api/house/search",
          data: {
            longitude: lng,
            latitude: lat,
            date_begin: begindate,
            date_end: enddate,
            number_of_beds: bed_num,
            max_distance: distance
          },
          success: function(msg) {
            var geocoder = new google.maps.Geocoder();
            var search_result = msg.house_list;
            $.each(search_result, function(index, n) {
              var rowTr = document.createElement("tr");
              var information =
                "<td>" +
                search_result[index].name +
                "&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp" +
                "</td>" +
                "<td>" +
                search_result[index].address +
                ","+
                "</td>" +
                "<td>" +
                search_result[index].city +
                ","+
                "</td>" +
                "<td>" +
                search_result[index].province +
                "&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp" +
                "&nbsp&nbsp&nbsp" +
                "</td>";
              var home_id_search = search_result[index].house_id;
              var detail_search = "<a href=\"detail.html?home_id="+home_id_search+"\">details</a>";  


              rowTr.innerHTML = information+detail_search;
              $(".show").append(rowTr);
              console.log(search_result[index].place_id);
              var geocoder = new google.maps.Geocoder();
              geocodeAddress(geocoder, map);
              function geocodeAddress(geocoder, resultsMap) {
                geocoder.geocode(
                  { placeId: search_result[index].place_id },
                  function(results, status) {
                    if (status === "OK") {
                      var marker = new google.maps.Marker({
                        map: resultsMap,
                        position: results[0].geometry.location
                      });
                    } else {
                      alert(
                        "Geocode was not successful for the following reason: " +
                          status
                      );
                    }
                  }
                );
              }
            });
          },
          fail: function() {
            console.log("search failed");
          }
        });
      };

      function explore() {
        $.ajax({
          type: "GET",
          url: "/api/house/search",
          success: function(data) {
            var room_information = data.house_list;
            $.each(room_information, function(index, n) {
              var rowTr = document.createElement("tr");
              var information =
                "<td>" +
                room_information[index].name +
                "&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp" +
                "</td>" +
                "<td>" +
                room_information[index].address +
                ","+
                "</td>" +
                "<td>" +
                room_information[index].city +
                ","+
                "</td>" +
                "<td>" +
                room_information[index].province +
                "&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp" +
                "</td>";
              var home_id = room_information[index].house_id;
              var detail = "<a href=\"detail.html?home_id="+home_id+"\">details</a>";
              rowTr.innerHTML = information+detail;
              $(".show").append(rowTr);
            });
          }
        });
      }
    </script>

    <script src="js/jquery-1.11.0.min.js" type="text/javascript"></script>
    <script src="https://cdn.bootcss.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="./js/InputSpinner.js"></script>
    <script>
        $("input[type='number']").InputSpinner()
        $("input.small").InputSpinner({ groupClass: "input-group-sm" })
        $("input.large").InputSpinner({ groupClass: "input-group-lg" })
    </script>


    
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDEr7VaXJrWbi79GbHar7CPAS1LyYDAyew&callback=initMap"
      async
      defer
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.2.1/js/bootstrap.min.js"></script>
  </body>
</html>
