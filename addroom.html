<!DOCTYPE html>
<html>
  <head>
    <title>Add a Room</title>
    <meta name="viewport" content="initial-scale=1.0" />
    <meta charset="utf-8" />
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 40%;
        margin-top:-15.5px;
      }
      /* Optional: Makes the sample page fill the window. */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      /*set the background*/
      .bg {
            background: url('./img/addroom_img.jpg');
            background-repeat: no-repeat;
            background-position: center;
            background-size: cover; 
            /* vertical-align: middle; */
            /* background-clip:border-box; */
            height:auto;
            line-height: auto;
            background-color:transparent;

      }
      .inner{
        height:100%;
        background: rgba(138, 134, 134, 0.575);
      }

      .title{
        padding:100px;
        margin-top:-30px;
      }
      .center{text-align:center}
      .textBg{
        background:rgb(209, 206, 206);
        height:100%;
        width:40%;
        /* text-align: center; */
        margin-left: 30%;
        margin-right:20%;
        margin-top:-5%;
        margin-bottom:100px;
        font-size:100%;
        color:rgb(17, 17, 17);
        border-radius:25px;
        padding:0.5cm;
      }
      /*set the nav bar*/
      ul {
       list-style-type: none;
       margin: 0;
       padding: 0;
       overflow: hidden;
       background-color:#e2e7ec;
       /* height:10%; */
      }

      li {
       /* float:left; */
       display:inline-block;
      }

      li img{
        margin-left:2%;
      }

      li a {
       display: block;
       color: rgb(17, 16, 16);
       text-align:center;
       padding:15px 35px;
       text-decoration: none;
      }    

      li a:hover {
       background-color: #e2e7ec;
      }

      .navfirst{
        margin-left: -550px;
      }
      
   
  
  
     

/* unpoad picture*/
.file-box {
    position: relative;
    display: inline-block;
    margin-top:0;
    width:100%;
}
.file-box img {
    width: 100%;
    height: 150%;
    border-radius: 5%;
    position: middle;
    /* display: inline-block; */
    /* border: none; */
}
.file-box .txt,.file-box .file {
    width: 70px;
    height: 36px;
    position: absolute;
    top: -20px;
    left: 100px;
    text-align: center;
}

.comments {
	width: 100%; /*自动适应父布局宽度*/
	overflow: auto;
	word-break: break-all;
}

.marginCreat{
  margin-top:5%;
}




    </style>
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
  </head>



  <body>
      <ul>
          <li><img  src="./img/logo.png" width="10%" height="10%"></li>
          <li class="navfirst"><a  href="/homepage.html">Home</a></li>
          <li><a  href="/signup.html">Sign Up</a></li>
          <li><a  href="/index.html">Sign In</a></li>
          <li><a  href="/">Sign Out</a></li>
          <li><a  href="/">About</a></li>
          
      </ul>


    <div id="map"></div>
    <div class="bg">
      <div class="inner">

        <div class="container-fluid center">
          <div class="title">
            <div class="row">
              <div class="col-md-12">
                <h3>
                  Add a room
                </h3>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-12">
              <div class="textBg">
                <form role="form" id="add-form" method="post">
                  <div class="form-group">
                    <label for="name">
                      House name
                    </label>
                    <div align="center">
                      <input type="text" class="form-control" id="name" name="name" />
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="street">
                      Street
                    </label>
                    <div align="center">
                      <input
                        type="text"
                        class="form-control"
                        id="street"
                        name="street"
                      />
                    </div>
                  </div>
                  <div class="form-group" align="center">
                    <label for="City">
                      City
                    </label>
                    <input type="text" class="form-control" id="city" name="city" />
                    <span id="checktext2" class="warning"></span>
                  </div>
                  <div class="form-group">
                    <label for="provinces">
                      Province
                    </label>
                    <div align="center">
                    <input
                      type="text"
                      class="form-control"
                      id="Provinces"
                      name="Provinces"
                      list="Provinces_list"
                      onchange="remap()"
                    />
                    </div>
                    <datalist id="Provinces_list">
                      <option>NL</option>
                      <option>PE</option>
                      <option>NS</option>
                      <option>NB</option>
                      <option>QC</option>
                      <option>ON</option>
                      <option>MB</option>
                      <option>SK</option>
                      <option>AB</option>
                      <option>BC</option>
                      <option>YT</option>
                      <option>NT</option>
                      <option>NU</option>
                    </datalist>
                   </div>
                  <div class="form-group">
                    <label for="code">
                      Postal code
                    </label>
                    <div align="center">
                    <input type="text" class="form-control" id="code" name="code" />
                    </div>
                  </div>
                  <div class="form-group" align="center">
                    <label for="exampleInputPassword1">
                      Number of bed
                    </label>
                    <input
                      type="text"
                      class="form-control"
                      id="beds"
                      placeholder="1"
                    />
                  </div>
                  <div class="form-group" align="center">
                    <label for="exampleInputPassword1">
                      Check in
                    </label>
                    <input type="date" class="form-control" id="date_start" />
                  </div>
                  <div class="form-group" align="center">
                    <label for="exampleInputPassword1">
                      Check out
                    </label>
                    <input type="date" class="form-control" id="date_end" />
                  </div>
                  <div class="form-group" align="center"> 
                    <label for="exampleInputEmail1">
                      Description
                    </label>
                    <textarea 
                      rows="5" 
                      cols="50" 
                      placeholder="Add some details about the room for your guest." 
                      class="comments"
                      autofocus>
                    </textarea>
                  </div>
                  <div class="file-box">
                      <img id="preview" />
                      <!-- <input type="text" id="imgfield" class="txt" placeholder="预览"> -->
                      <input type="file" name="file" id = "input_file" accept="image/gif,image/jpeg,image/jpg,image/png,image/svg" onchange="imgPreview(this)" >  
                  </div>
                 
                  
             
                  <div class="form-group marginCreat" align="center" > 
                    <button type="submit" class="btn btn-primary" >
                      Create your room
                    </button>
                  </div>
                </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>
      <script>
      var map;
      var lat;
      var lng;
      var placeid;
      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: -34.397, lng: 150.644 },
          zoom: 15
        });
      }
      function remap() {
        var geocoder = new google.maps.Geocoder();
        geocodeAddress(geocoder, map);
        function geocodeAddress(geocoder, resultsMap) {
          var street = document.getElementById("street").value;
          var city = document.getElementById("city").value;
          var provinces = document.getElementById("Provinces").value;
          var address = street + ", " + city + ", " + provinces;
          geocoder.geocode({ address: address }, function(results, status) {
            if (status === "OK") {
              resultsMap.setCenter(results[0].geometry.location);
              map.setZoom(15);
              var marker = new google.maps.Marker({
                map: resultsMap,
                position: results[0].geometry.location
              });
              lat = results[0].geometry.location.lat();
              lng = results[0].geometry.location.lng();
              placeid = results[0].place_id;
            } else {
              alert(
                "Geocode was not successful for the following reason: " + status
              );
            }
          });
        }
      }



      var form_login = document.getElementById("add-form");
      form_login.onsubmit = function(e) {
        e.preventDefault();
        var housename = document.getElementById("name").value;
        var streetname = document.getElementById("street").value;
        var cityname = document.getElementById("city").value;
        var provincename = document.getElementById("Provinces").value;
        var postalcode = document.getElementById("code").value;
        var bed_num = document.getElementById("beds").value;
        var startdate = document.getElementById("date_start").value;
        var enddate = document.getElementById("date_end").value;
        $.ajax({
          type: "POST",
          url: "/api/house/create",
          xhrFields: {
            withCredentials: true
          },
          crossDomain: true,
          data: {
            house_name: housename,
            place_id: placeid,
            house_address: streetname,
            house_city: cityname,
            house_province: provincename,
            house_postcode: postalcode,
            longitude: lng,
            latitude: lat,
            number_of_beds: bed_num,
            date_begin: startdate,
            date_end: enddate
          },
          success: function(msg) {
            console.log(msg);
            window.location.href = "/homepage.html";
          },
          fail: function() {
            console.log("add failed");
            alert("add failed, see dev tool");
          }
        });
      };



/* js of upload img*/  
      function imgPreview(fileDom) {
    
         if(window.FileReader) {
           var reader = new FileReader();
         } 
         else {
           alert("您的设备不支持图片预览功能，如需该功能请升级您的设备！");
         }
    
         var file = fileDom.files[0];
         var imageType = /^image\//;
    
         if(!imageType.test(file.type)) {
           alert("请选择图片！");
        return;
         }
    
    reader.onload = function(e) {
        
        var img = document.getElementById("preview");
    
        img.src = e.target.result;
    };
    reader.readAsDataURL(file);
}









    </script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDEr7VaXJrWbi79GbHar7CPAS1LyYDAyew&callback=initMap"
      async
      defer
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.2.1/js/bootstrap.min.js"></script>
  </body>
</html>
